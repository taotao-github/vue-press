# 8、数据库操作语言

## 8.1、插入数据

1. 形式 1:

```sql
insert [into] 表名 [(字段1, 字段2, …)] values(值表达式1, 值表达式2, …), (…), (…)
# a) 这是最常用的插入语句，可以一次性插入多行数据，用逗号隔开
# b) 字段名通常不推荐省略，其后续的值表达式列表应该跟字段名保持一一对应
# c) 其中值表达式可以直接是一个值或者函数调用结果或者变量。如果对应的字段是时间或字符类型，则直接值应该加引号。
```

2. 形式 2：

```sql
replace [into] 表名 [(字段1, 字段2, …)] values(值表达式1, 值表达式2, …), (…), (…)
# a) 其实跟insert into 几乎一样，唯一不同就是，如果插入主键有重复，则直接替换，而insert into会报错。
```

3. 形式 3：

```sql
insert [into] 表名 [(字段1, 字段2, …)] select 字段1, 字段2, … from 表名
# a) 将select 语句查询的结果（可能有多条），都插入到指定的表中
# b) 注意字段的对应，select 出来的字段应该跟前面指定的字段列表一一对应
```

4. 形式 4：

```sql
insert [into] 表名 set 字段1=值表达式1, 字段2=值表达式2, …
```

## 8.2、删除数据

语法形式：

```sql
delete from 表名 [where 条件] [order by 排序] [limit 限定]
```

说明：

1. 删除数据仍然是以行为单位进行
2. 通常删除数据都需要带有 where 条件，否则就会删除所有数据
3. where 条件的语法跟 select 中的语法一样
4. order by 排序设定，用于指定这些数据的删除顺序。他通常更 limit 一起使用才有意义
5. limit 限定用于设定删除多少行（按照 order by 设定的顺序）
6. 实际应用中，通常很少设置用到 order by 和 limit

## 8.3、修改数据

语法形式：

```sql
update表名 set 字段1=值1, 字段2=值2, … [where 条件] [order by 排序] [limit 限定]
```

说明：通常 update 语句也需要 where 条件，否则会修改所有数据

## 8.4、查询数据

基本语法形式：

```sql
select [all | distinct] 字段或者表达式 [from 子句] [where 子句] [group by子句] [having子句] [order by子句] [limit 子句]
```

### 8.4.1、字段或者表达式列表

1. 字段，自然是来源于表，则其必然是依赖于 from 子句
2. 表达式是类似这样的一个内容：8, 8+3, now()

```sql
mysql> select 8;
+---+
| 8 |
+---+
| 8 |
+---+
1 row in set (0.00 sec)

mysql> select 8+3;
+-----+
| 8+3 |
+-----+
|  11 |
+-----+
1 row in set (0.00 sec)

mysql> select now() as nowtime;
+---------------------+
| nowtime             |
+---------------------+
| 2019-12-03 19:52:23 |
+---------------------+
1 row in set (0.00 sec)
mysql> select 8, 8+3, concat('a', 'b', 'c'), now();
+---+-----+-----------------------+---------------------+
| 8 | 8+3 | concat('a', 'b', 'c') | now()               |
+---+-----+-----------------------+---------------------+
| 8 |  11 | abc                   | 2019-12-03 19:55:48 |
+---+-----+-----------------------+---------------------+
1 row in set (0.00 sec)
```

> 其中: concat() 函数是 mysql 中的系统函数，主要用于连接多个字符串；注意 每个输出项都可以 s 使用 as 关键字设置别名

### 8.4.2、all 和 distinct

作用：用于设定 select 出来的数据是否消除‘重复行’，可以不写，默认是 all。all 表示不消除，即查出所有的数据。distinct: 表示会消除。

```sql
 mysql> select all * from tab_test;
+------+------+------+
| f1   | f2   | f3   |
+------+------+------+
|   12 |   12 |   12 |
|  123 |  123 |  123 |
|  123 |  123 |  123 |
|  123 |  123 |  123 |
|  123 |  123 |  123 |
+------+------+------+
5 rows in set (0.00 sec)

mysql>

mysql> select distinct * from tab_test;
+------+------+------+
| f1   | f2   | f3   |
+------+------+------+
|   12 |   12 |   12 |
|  123 |  123 |  123 |
+------+------+------+
2 rows in set (0.00 sec)

mysql>
```

### 8.4.3、from 子句

::: tip 作用
from 子句表示 select 部分取得数据的数据源 -- 可以理解为表。通常其后面跟随的是表名，但是也可能是其他的数据来源，如表连接数据、视图、select 子查询的数据等
:::

### 8.4.4、where 子句

作用：

1. where 子句就是对 from 子句中的数据源中数据进行筛选的条件设定，筛选的机制是‘一行一行进行判断’，类似各种语言中的 if 语句。
2. where 子句依赖于 from 子句
3. where 子句中常用的各种运算符

   - 算术运算符：+ - \* / %
   - 比较运算符：> >= < <= =（等于） <>（不等于） ==（等于） != （不等于）
   - 逻辑运算符：and or not
   - is 运算符：空值和布尔值的判断，有 4 种情况的使用：

     1. xx is null：判断某个字段是 null 值 （就是没有值）
     2. xx is not null：判断某个字段不是 null
     3. xx is true：判断某个字段为真（true）
     4. xx is false：判断某个字段为假（false： 0， 0.0，‘’ ，null）

     ```sql
     mysql> select * from tab_test;
     +------+------+------+
     | f1   | f2   | f3   |
     +------+------+------+
     |   12 |   12 |   12 |
     |  123 |  123 |  123 |
     |  123 |  123 |  123 |
     |  123 |  123 |  123 |
     |  123 |  123 |  123 |
     |  123 |    0 |  123 |
     +------+------+------+
     6 rows in set (0.00 sec)

     mysql> select * from tab_test where f2 is true;
     +------+------+------+
     | f1   | f2   | f3   |
     +------+------+------+
     |   12 |   12 |   12 |
     |  123 |  123 |  123 |
     |  123 |  123 |  123 |
     |  123 |  123 |  123 |
     |  123 |  123 |  123 |
     +------+------+------+
     5 rows in set (0.00 sec)

     mysql> select * from tab_test where f2 is not true;
     +------+------+------+
     | f1   | f2   | f3   |
     +------+------+------+
     |  123 |    0 |  123 |
     +------+------+------+
     1 row in set (0.00 sec)
     ```

   - between 运算符：判断范围

     用于判断某个字段的数据值是否在某个给定的范围内 （适用于数字类型）。

     语法：xx between 值 1 and 值 2 （相当于 xx>=值 1 and xx <= 值 2）

     ```sql
     mysql> select * from tab_stu;
     +----+--------+------+-----------+-------+
     | id | name   | sex  | address   | score |
     +----+--------+------+-----------+-------+
     |  1 | 张三   | 男   | 重庆      |    12 |
     |  2 | 张三   | 女   | 四川      |    22 |
     |  3 | 李四   | 男   | 河北      |    26 |
     |  4 | 王五   | 男   | 黑龙江    |    20 |
     |  5 | 黄伞   | 男   | 江南      |    40 |
     +----+--------+------+-----------+-------+
     5 rows in set (0.00 sec)

     mysql> select * from tab_stu where score between 20 and 30;
     +----+--------+------+-----------+-------+
     | id | name   | sex  | address   | score |
     +----+--------+------+-----------+-------+
     |  2 | 张三   | 女   | 四川      |    22 |
     |  3 | 李四   | 男   | 河北      |    26 |
     |  4 | 王五   | 男   | 黑龙江    |    20 |
     +----+--------+------+-----------+-------+
     3 rows in set (0.00 sec)

     mysql>
     ```

   - in 运算符：是否在给定数据里

     语法：xx in (值 1，值 2，值 3, …)

     含义：表示字段 xx 的值是否在给定数值中，有就输出，没有就不输出

     ```sql
     mysql> select * from tab_stu;
     +----+--------+------+-----------+-------+
     | id | name   | sex  | address   | score |
     +----+--------+------+-----------+-------+
     |  1 | 张三   | 男   | 重庆      |    12 |
     |  2 | 张三   | 女   | 四川      |    22 |
     |  3 | 李四   | 男   | 河北      |    26 |
     |  4 | 王五   | 男   | 黑龙江    |    20 |
     |  5 | 黄伞   | 男   | 江南      |    40 |
     +----+--------+------+-----------+-------+
     5 rows in set (0.00 sec)

     mysql> select * from tab_stu where id in (1,3,5);
     +----+--------+------+---------+-------+
     | id | name   | sex  | address | score |
     +----+--------+------+---------+-------+
     |  1 | 张三   | 男   | 重庆    |    12 |
     |  3 | 李四   | 男   | 河北    |    26 |
     |  5 | 黄伞   | 男   | 江南    |    40 |
     +----+--------+------+---------+-------+
     3 rows in set (0.00 sec)

     mysql>
     # in 只要用于无规律的数据查询中。
     ```

   - like：对字符进行模糊查询
     语法：xx like ‘要查找的内容’

     含义：实现对字符串的某种特征信息的模糊查询。主要依赖以下 2 个特殊符号

     - %：表示任意数量的任何字符
     - \_：下划线表示一个任意字符

     ```sql
     mysql> select * from tab_stu;
     +----+--------+------+-----------+-------+
     | id | name   | sex  | address   | score |
     +----+--------+------+-----------+-------+
     |  1 | 张三   | 男   | 重庆      |    12 |
     |  2 | 张三   | 女   | 四川      |    22 |
     |  3 | 李四   | 男   | 河北      |    26 |
     |  4 | 王五   | 男   | 黑龙江    |    20 |
     |  5 | 黄伞   | 男   | 江南      |    40 |
     +----+--------+------+-----------+-------+
     5 rows in set (0.00 sec)

     mysql> select * from tab_stu where address like '%江%';
     +----+--------+------+-----------+-------+
     | id | name   | sex  | address   | score |
     +----+--------+------+-----------+-------+
     |  4 | 王五   | 男   | 黑龙江    |    20 |
     |  5 | 黄伞   | 男   | 江南      |    40 |
     +----+--------+------+-----------+-------+
     2 rows in set (0.00 sec)

     mysql> select * from tab_stu where address like '江%';
     +----+--------+------+---------+-------+
     | id | name   | sex  | address | score |
     +----+--------+------+---------+-------+
     |  5 | 黄伞   | 男   | 江南    |    40 |
     +----+--------+------+---------+-------+
     1 row in set (0.00 sec)

     mysql> select * from tab_stu where address like '%江';
     +----+--------+------+-----------+-------+
     | id | name   | sex  | address   | score |
     +----+--------+------+-----------+-------+
     |  4 | 王五   | 男   | 黑龙江    |    20 |
     +----+--------+------+-----------+-------+
     1 row in set (0.00 sec)

     mysql> select * from tab_stu where address like '_江';
     Empty set (0.00 sec)

     mysql> select * from tab_stu where address like '__江';
     +----+--------+------+-----------+-------+
     | id | name   | sex  | address   | score |
     +----+--------+------+-----------+-------+
     |  4 | 王五   | 男   | 黑龙江    |    20 |
     +----+--------+------+-----------+-------+
     1 row in set (0.00 sec)

     mysql>
     ```

### 8.4.5、group by 子句（分组）

分组：就是讲多行数据以某种标椎（字段）来进行分类存放。也就是按照这个字段的不同值分组成一个组。

语法：select 组信息 1，组信息 2，… from 数据源 group by 字段

示例：

<table width="100%">
<tbody>
<tr>
  <td width="5%"><p>id</p></td>
  <td width="52%"><p>pro_name</p></td>
  <td width="5%"><p>type_id</p></td>
  <td width="13%"><p>price</p></td>
  <td width="11%"><p>pinpai</p></td>
  <td width="11%"><p>chandi</p></td>
</tr>
<tr>
  <td width="4%"><p>1</p></td>
  <td width="51%"><p>康佳42英寸全高清液晶电视</p></td>
  <td width="9%"><p>1</p></td>
  <td width="12%"><p>1999</p></td>
  <td width="10%"><p>康佳</p></td>
  <td width="10%"><p>深圳</p></td>
</tr>
<tr>
  <td width="4%"><p>2</p></td>
  <td width="51%"><p>索宁60英寸全高清液晶电视</p></td>
  <td width="9%"><p>1</p></td>
  <td width="12%"><p>6999</p></td>
  <td width="10%"><p>索尼</p></td>
  <td width="10%"><p>北京</p></td>
</tr>
<tr>
  <td width="4%"><p>3</p></td>
  <td width="51%"><p>海信55英寸智能电视</p></td>
  <td width="9%"><p>1</p></td>
  <td width="12%"><p>4199</p></td>
  <td width="10%"><p>海信</p></td>
  <td width="10%"><p>青岛</p></td>
</tr>
<tr>
  <td width="4%"><p>4</p></td>
  <td width="51%"><p>索宁 4个手机黑色</p></td>
  <td width="9%"><p>2</p></td>
  <td width="12%"><p>3299</p></td>
  <td width="10%"><p>索尼</p></td>
  <td width="10%"><p>深圳</p></td>
</tr>
<tr>
  <td width="4%"><p>5</p></td>
  <td width="51%"><p>联想双卡双待3g手机</p></td>
  <td width="9%"><p>2</p></td>
  <td width="12%"><p>999</p></td>
  <td width="10%"><p>联想</p></td>
  <td width="10%"><p>北京</p></td>
</tr>
<tr>
  <td width="5%"><p>6</p></td>
  <td width="52%"><p>联想 14寸笔记本电脑</p></td>
  <td width="5%"><p>3</p></td>
  <td width="13%"><p>5499</p></td>
  <td width="11%"><p>联想</p></td>
  <td width="11%"><p>北京</p></td>
</tr>
<tr>
  <td width="4%"><p>7</p></td>
  <td width="51%"><p>联想 14寸笔记本电脑</p></td>
  <td width="9%"><p>3</p></td>
  <td width="12%"><p>2499</p></td>
  <td width="10%"><p>联想</p></td>
  <td width="10%"><p>北京</p></td>
</tr>
<tr>
  <td width="4%"><p>8</p></td>
  <td width="51%"><p>惠普黑白激光打印机</p></td>
  <td width="9%"><p>4</p></td>
  <td width="12%"><p>1999</p></td>
  <td width="10%"><p>惠普</p></td>
  <td width="10%"><p>天津</p></td>
</tr>
<tr>
  <td width="4%"><p>9</p></td>
  <td width="51%"><p>索尼 13寸触控超极本</p></td>
  <td width="9%"><p>3</p></td>
  <td width="12%"><p>11499</p></td>
  <td width="10%"><p>索尼</p></td>
  <td width="10%"><p>深圳</p></td>
</tr>
</tbody>
</table>

根据品牌分组:

<table width="100%">
<tbody>
<tr>
  <td width="4%"><p>id</p></td>
  <td width="51%"><p>pro_name</p></td>
  <td width="9%"><p>type_id</p></td>
  <td width="12%"><p>price</p></td>
  <td width="10%"><p>pinpai</p></td>
  <td width="10%"><p>chandi</p></td>
</tr>
<tr>
  <td width="4%"><p>3</p></td>
  <td width="51%"><p>海信55英寸智能电视</p></td>
  <td width="9%"><p>1</p></td>
  <td width="12%"><p>4199</p></td>
  <td width="10%"><p>海信</p></td>
  <td width="10%"><p>青岛</p></td>
</tr>
<tr>
  <td width="4%"><p>8</p></td>
  <td width="51%"><p>惠普黑白激光打印机</p></td>
  <td width="9%"><p>4</p></td>
  <td width="12%"><p>1999</p></td>
  <td width="10%"><p>惠普</p></td>
  <td width="10%"><p>天津</p></td>
</tr>
<tr>
  <td width="4%"><p>1</p></td>
  <td width="51%"><p>康佳42英寸全高清液晶电视</p></td>
  <td width="9%"><p>1</p></td>
  <td width="12%"><p>1999</p></td>
  <td width="10%"><p>康佳</p></td>
  <td width="10%"><p>深圳</p></td>
</tr>
<tr>
  <td width="4%"><p>5</p></td>
  <td width="51%"><p>联想双卡双待3g手机</p></td>
  <td width="9%"><p>2</p></td>
  <td width="12%"><p>999</p></td>
  <td width="10%"><p>联想</p></td>
  <td width="10%"><p>北京</p></td>
</tr>
<tr>
  <td width="4%"><p>6</p></td>
  <td width="51%"><p>联想 14寸笔记本电脑</p></td>
  <td width="9%"><p>3</p></td>
  <td width="12%"><p>5499</p></td>
  <td width="10%"><p>联想</p></td>
  <td width="10%"><p>北京</p></td>
</tr>
<tr>
  <td width="4%"><p>7</p></td>
  <td width="51%"><p>联想 14寸笔记本电脑</p></td>
  <td width="9%"><p>3</p></td>
  <td width="12%"><p>2499</p></td>
  <td width="10%"><p>联想</p></td>
  <td width="10%"><p>北京</p></td>
</tr>
<tr>
  <td width="4%"><p>2</p></td>
  <td width="51%"><p>索宁60英寸全高清液晶电视</p></td>
  <td width="9%"><p>1</p></td>
  <td width="12%"><p>6999</p></td>
  <td width="10%"><p>索尼</p></td>
  <td width="10%"><p>北京</p></td>
</tr>
<tr>
  <td width="4%"><p>4</p></td>
  <td width="51%"><p>索宁 4个手机黑色</p></td>
  <td width="9%"><p>2</p></td>
  <td width="12%"><p>3299</p></td>
  <td width="10%"><p>索尼</p></td>
  <td width="10%"><p>深圳</p></td>
</tr>
<tr>
  <td width="4%"><p>9</p></td>
  <td width="51%"><p>索尼 13寸触控超极本</p></td>
  <td width="9%"><p>3</p></td>
  <td width="12%"><p>11499</p></td>
  <td width="10%"><p>索尼</p></td>
  <td width="10%"><p>深圳</p></td>
</tr>
</tbody>
</table>

我们对这些组（5组），应该理解为5条数据。应用中，分组之后，通常只有如下几种可用的’组信息’。
1. 分组依据本身的信息，其实就是该分组依据的字段名。
2. 每一组的数量信息，用count(*) 获取
3. 原来数据中的“数值类型字段的聚合信息”，包括如下几个：
    * 最大值：max(字段名)
    * 最小值：min(字段名)
    * 平均值：avg(字段名)
    * 总和值：sum(字段名)

其实就是4个系统内部函数。
```sql
mysql> select pinpai 品牌, count(*) as '数量',max(price) as '最高价', min(price) as '最低价', avg(price) as '平均价', sum(price) as '总价' from product group by pinpai;
+--------+--------+-----------+-----------+-----------+--------+
| 品牌   | 数量   | 最高价    | 最低价    | 平均价    | 总价   |
+--------+--------+-----------+-----------+-----------+--------+
| 康佳   |      1 |      1999 |      1999 | 1999.0000 |   1999 |
| 索尼   |      3 |     11499 |      3299 | 7265.6667 |  21797 |
| 海信   |      1 |      4199 |      4199 | 4199.0000 |   4199 |
| 联想   |      3 |      5499 |       999 | 2999.0000 |   8997 |
| 惠普   |      1 |      1999 |      1999 | 1999.0000 |   1999 |
+--------+--------+-----------+-----------+-----------+--------+
5 rows in set (0.00 sec)

mysql>
```

### 8.4.6、having 子句
::: tip 作用
having的作用跟where一样，只不过having只对group by（分组）后的数据进行条件筛选。即where对数据来源进行筛选，having对分组后的分组数据进行筛选。
:::

```sql
# 筛选平均价格大于5000的品牌信息
mysql> select pinpai 品牌, count(*) as '数量',max(price) as '最高价', min(price) as '最低价', avg(price) as '平均价', sum(price) as '总价' from product group by pinpai having 平均价 > 5000;
+--------+--------+-----------+-----------+-----------+--------+
| 品牌   | 数量   | 最高价    | 最低价    | 平均价    | 总价   |
+--------+--------+-----------+-----------+-----------+--------+
| 索尼   |      3 |     11499 |      3299 | 7265.6667 |  21797 |
+--------+--------+-----------+-----------+-----------+--------+
1 row in set (0.00 sec)

mysql>

# 找出数量超过2的品牌信息
mysql> select pinpai 品牌, count(*) as '数量',max(price) as '最高价', min(price) as '最低价', avg(price) as '平均价', sum(price) as '总价' from product group by pinpai having 数量 > 2;
+--------+--------+-----------+-----------+-----------+--------+
| 品牌   | 数量   | 最高价    | 最低价    | 平均价    | 总价   |
+--------+--------+-----------+-----------+-----------+--------+
| 索尼   |      3 |     11499 |      3299 | 7265.6667 |  21797 |
| 联想   |      3 |      5499 |       999 | 2999.0000 |   8997 |
+--------+--------+-----------+-----------+-----------+--------+
2 rows in set (0.00 sec)

mysql>
```

### 8.4.7、order by ：排序
语法：
```sql
order by 字段1 [asc | desc], 字段2 [asc | desc], …
说明：
# 1.对前面的结果数据以指定的一个或者多个字段排序
# 2.正序 asc （默认），倒序desc
# 3.多个字段排序，都是在前一个字段排序的基础上再排序。
```
```sql
mysql> select * from product;
+----+-------------------------------------+---------+-------+--------+--------+
| id | pro_name                            | type_id | price | pinpai | chandi |
+----+-------------------------------------+---------+-------+--------+--------+
|  1 | 康佳42英寸全高清液晶电视            |       1 |  1999 | 康佳   | 深圳   |
|  2 | 索宁60英寸全高清液晶电视            |       1 |  6999 | 索尼   | 北京   |
|  3 | 海信55英寸智能电视                  |       1 |  4199 | 海信   | 青岛   |
|  4 | 索宁 4个手机黑色                    |       2 |  3299 | 索尼   | 深圳   |
|  5 | 联想双卡双待3g手机                  |       2 |   999 | 联想   | 北京   |
|  6 | 联想 14寸笔记本电脑                 |       3 |  5499 | 联想   | 北京   |
|  7 | 联想 14寸笔记本电脑                 |       3 |  2499 | 联想   | 北京   |
|  8 | 惠普黑白激光打印机                  |       4 |  1999 | 惠普   | 天津   |
|  9 | 索尼 13寸触控超极本                 |       3 | 11499 | 索尼   | 深圳   |
| 10 | 亲嘴烧                              |       9 |     2 | 天友   | 四川   |
+----+-------------------------------------+---------+-------+--------+--------+
10 rows in set (0.00 sec)

mysql> select * from product order by price asc;
+----+-------------------------------------+---------+-------+--------+--------+
| id | pro_name                            | type_id | price | pinpai | chandi |
+----+-------------------------------------+---------+-------+--------+--------+
| 10 | 亲嘴烧                              |       9 |     2 | 天友   | 四川   |
|  5 | 联想双卡双待3g手机                  |       2 |   999 | 联想   | 北京   |
|  1 | 康佳42英寸全高清液晶电视            |       1 |  1999 | 康佳   | 深圳   |
|  8 | 惠普黑白激光打印机                  |       4 |  1999 | 惠普   | 天津   |
|  7 | 联想 14寸笔记本电脑                 |       3 |  2499 | 联想   | 北京   |
|  4 | 索宁 4个手机黑色                    |       2 |  3299 | 索尼   | 深圳   |
|  3 | 海信55英寸智能电视                  |       1 |  4199 | 海信   | 青岛   |
|  6 | 联想 14寸笔记本电脑                 |       3 |  5499 | 联想   | 北京   |
|  2 | 索宁60英寸全高清液晶电视            |       1 |  6999 | 索尼   | 北京   |
|  9 | 索尼 13寸触控超极本                 |       3 | 11499 | 索尼   | 深圳   |
+----+-------------------------------------+---------+-------+--------+--------+
10 rows in set (0.00 sec)

mysql> select * from product order by price asc, pinpai desc;
+----+-------------------------------------+---------+-------+--------+--------+
| id | pro_name                            | type_id | price | pinpai | chandi |
+----+-------------------------------------+---------+-------+--------+--------+
| 10 | 亲嘴烧                              |       9 |     2 | 天友   | 四川   |
|  5 | 联想双卡双待3g手机                  |       2 |   999 | 联想   | 北京   |
|  8 | 惠普黑白激光打印机                  |       4 |  1999 | 惠普   | 天津   |
|  1 | 康佳42英寸全高清液晶电视            |       1 |  1999 | 康佳   | 深圳   |
|  7 | 联想 14寸笔记本电脑                 |       3 |  2499 | 联想   | 北京   |
|  4 | 索宁 4个手机黑色                    |       2 |  3299 | 索尼   | 深圳   |
|  3 | 海信55英寸智能电视                  |       1 |  4199 | 海信   | 青岛   |
|  6 | 联想 14寸笔记本电脑                 |       3 |  5499 | 联想   | 北京   |
|  2 | 索宁60英寸全高清液晶电视            |       1 |  6999 | 索尼   | 北京   |
|  9 | 索尼 13寸触控超极本                 |       3 | 11499 | 索尼   | 深圳   |
+----+-------------------------------------+---------+-------+--------+--------+
10 rows in set (0.00 sec)

mysql>
```

### 8.4.8、limit 子句
作用：限制输出数据的数量（一般用于分页）

语法：limit n, m：从n行开始输出之后的m行数据

```sql
mysql> select * from product;
+----+-------------------------------------+---------+-------+--------+--------+
| id | pro_name                            | type_id | price | pinpai | chandi |
+----+-------------------------------------+---------+-------+--------+--------+
|  1 | 康佳42英寸全高清液晶电视            |       1 |  1999 | 康佳   | 深圳   |
|  2 | 索宁60英寸全高清液晶电视            |       1 |  6999 | 索尼   | 北京   |
|  3 | 海信55英寸智能电视                  |       1 |  4199 | 海信   | 青岛   |
|  4 | 索宁 4个手机黑色                    |       2 |  3299 | 索尼   | 深圳   |
|  5 | 联想双卡双待3g手机                  |       2 |   999 | 联想   | 北京   |
|  6 | 联想 14寸笔记本电脑                 |       3 |  5499 | 联想   | 北京   |
|  7 | 联想 14寸笔记本电脑                 |       3 |  2499 | 联想   | 北京   |
|  8 | 惠普黑白激光打印机                  |       4 |  1999 | 惠普   | 天津   |
|  9 | 索尼 13寸触控超极本                 |       3 | 11499 | 索尼   | 深圳   |
+----+-------------------------------------+---------+-------+--------+--------+
9 rows in set (0.00 sec)

mysql> select * from product limit 2,5;
+----+-----------------------------+---------+-------+--------+--------+
| id | pro_name                    | type_id | price | pinpai | chandi |
+----+-----------------------------+---------+-------+--------+--------+
|  3 | 海信55英寸智能电视          |       1 |  4199 | 海信   | 青岛   |
|  4 | 索宁 4个手机黑色            |       2 |  3299 | 索尼   | 深圳   |
|  5 | 联想双卡双待3g手机          |       2 |   999 | 联想   | 北京   |
|  6 | 联想 14寸笔记本电脑         |       3 |  5499 | 联想   | 北京   |
|  7 | 联想 14寸笔记本电脑         |       3 |  2499 | 联想   | 北京   |
+----+-----------------------------+---------+-------+--------+--------+
5 rows in set (0.00 sec)

mysql>
```

## 8.5、连接查询
> 就是将两个或者两个以上的表，连接起来，当作一个数据源，并从中取得所需的数据。原理就是将每一个表中的每一行数据两两对接起来。如表1有n行数据，表2有m行数据，对接起来就有n*m行数据。

<img :src="$withBase('/images/mysql/mysql连接查询.png')" alt="连接查询">

### 8.5.1、连接基本形式
```sql
表1 [连接形式] join表2 [连接条件] # 2表
表1 [连接形式] join 表2 [连接条件] [连接形式] join 表3 [连接条件] # 3表
# 更多表：依次类推
```

### 8.5.2、连接的分类

#### 1、交叉连接
> 就是没有连接条件的连接形式。这类连接实现简单，但是数据可用性差。
```sql
mysql> select * from product inner join product_type; # 交叉连接
+----+-------------------------------------+---------+-------+--------+--------+----+--------------+
| id | pro_name                            | type_id | price | pinpai | chandi | id | type_name    |
+----+-------------------------------------+---------+-------+--------+--------+----+--------------+
|  1 | 康佳42英寸全高清液晶电视            |       1 |  1999 | 康佳   | 深圳   |  4 | 办公用品     |
|  1 | 康佳42英寸全高清液晶电视            |       1 |  1999 | 康佳   | 深圳   |  1 | 家用电器     | #
|  1 | 康佳42英寸全高清液晶电视            |       1 |  1999 | 康佳   | 深圳   |  2 | 手机数码     |
|  1 | 康佳42英寸全高清液晶电视            |       1 |  1999 | 康佳   | 深圳   |  3 | 电脑         |
|  2 | 索宁60英寸全高清液晶电视            |       1 |  6999 | 索尼   | 北京   |  4 | 办公用品     |
|  2 | 索宁60英寸全高清液晶电视            |       1 |  6999 | 索尼   | 北京   |  1 | 家用电器     | #
|  2 | 索宁60英寸全高清液晶电视            |       1 |  6999 | 索尼   | 北京   |  2 | 手机数码     |
|  2 | 索宁60英寸全高清液晶电视            |       1 |  6999 | 索尼   | 北京   |  3 | 电脑         |
|  3 | 海信55英寸智能电视                  |       1 |  4199 | 海信   | 青岛   |  4 | 办公用品     |
|  3 | 海信55英寸智能电视                  |       1 |  4199 | 海信   | 青岛   |  1 | 家用电器     | #
|  3 | 海信55英寸智能电视                  |       1 |  4199 | 海信   | 青岛   |  2 | 手机数码     |
|  3 | 海信55英寸智能电视                  |       1 |  4199 | 海信   | 青岛   |  3 | 电脑         |
|  4 | 索宁 4个手机黑色                    |       2 |  3299 | 索尼   | 深圳   |  4 | 办公用品     |
|  4 | 索宁 4个手机黑色                    |       2 |  3299 | 索尼   | 深圳   |  1 | 家用电器     |
|  4 | 索宁 4个手机黑色                    |       2 |  3299 | 索尼   | 深圳   |  2 | 手机数码     | #
|  4 | 索宁 4个手机黑色                    |       2 |  3299 | 索尼   | 深圳   |  3 | 电脑         |
|  5 | 联想双卡双待3g手机                  |       2 |   999 | 联想   | 北京   |  4 | 办公用品     |
|  5 | 联想双卡双待3g手机                  |       2 |   999 | 联想   | 北京   |  1 | 家用电器     |
|  5 | 联想双卡双待3g手机                  |       2 |   999 | 联想   | 北京   |  2 | 手机数码     | #
|  5 | 联想双卡双待3g手机                  |       2 |   999 | 联想   | 北京   |  3 | 电脑         |
|  6 | 联想 14寸笔记本电脑                 |       3 |  5499 | 联想   | 北京   |  4 | 办公用品     |
|  6 | 联想 14寸笔记本电脑                 |       3 |  5499 | 联想   | 北京   |  1 | 家用电器     |
|  6 | 联想 14寸笔记本电脑                 |       3 |  5499 | 联想   | 北京   |  2 | 手机数码     |
|  6 | 联想 14寸笔记本电脑                 |       3 |  5499 | 联想   | 北京   |  3 | 电脑         | #
|  7 | 联想 14寸笔记本电脑                 |       3 |  2499 | 联想   | 北京   |  4 | 办公用品     |
|  7 | 联想 14寸笔记本电脑                 |       3 |  2499 | 联想   | 北京   |  1 | 家用电器     |
|  7 | 联想 14寸笔记本电脑                 |       3 |  2499 | 联想   | 北京   |  2 | 手机数码     |
|  7 | 联想 14寸笔记本电脑                 |       3 |  2499 | 联想   | 北京   |  3 | 电脑         | #
|  8 | 惠普黑白激光打印机                  |       4 |  1999 | 惠普   | 天津   |  4 | 办公用品     | #
|  8 | 惠普黑白激光打印机                  |       4 |  1999 | 惠普   | 天津   |  1 | 家用电器     |
|  8 | 惠普黑白激光打印机                  |       4 |  1999 | 惠普   | 天津   |  2 | 手机数码     |
|  8 | 惠普黑白激光打印机                  |       4 |  1999 | 惠普   | 天津   |  3 | 电脑         |
|  9 | 索尼 13寸触控超极本                 |       3 | 11499 | 索尼   | 深圳   |  4 | 办公用品     |
|  9 | 索尼 13寸触控超极本                 |       3 | 11499 | 索尼   | 深圳   |  1 | 家用电器     |
|  9 | 索尼 13寸触控超极本                 |       3 | 11499 | 索尼   | 深圳   |  2 | 手机数码     |
|  9 | 索尼 13寸触控超极本                 |       3 | 11499 | 索尼   | 深圳   |  3 | 电脑         | #
+----+-------------------------------------+---------+-------+--------+--------+----+--------------+
36 rows in set (0.00 sec)
```
其中标记 ‘#’的数据行，是正确的，有意义的数据。而其他行都是错误的数据。这些有意义的数据有一个特点就是type_id与第二个id值一样，这就是on进行筛选的条件。

#### 2、内连接
形式：
```sql
select * from 表1 [inner] join 表2 on 连接条件
```

举例：
```sql
mysql> select * from product t1 inner join product_type t2 on t1.type_id = t2.id;
+----+-------------------------------------+---------+-------+--------+--------+----+--------------+
| id | pro_name                            | type_id | price | pinpai | chandi | id | type_name    |
+----+-------------------------------------+---------+-------+--------+--------+----+--------------+
|  1 | 康佳42英寸全高清液晶电视            |       1 |  1999 | 康佳   | 深圳   |  1 | 家用电器     |
|  2 | 索宁60英寸全高清液晶电视            |       1 |  6999 | 索尼   | 北京   |  1 | 家用电器     |
|  3 | 海信55英寸智能电视                  |       1 |  4199 | 海信   | 青岛   |  1 | 家用电器     |
|  4 | 索宁 4个手机黑色                    |       2 |  3299 | 索尼   | 深圳   |  2 | 手机数码     |
|  5 | 联想双卡双待3g手机                  |       2 |   999 | 联想   | 北京   |  2 | 手机数码     |
|  6 | 联想 14寸笔记本电脑                 |       3 |  5499 | 联想   | 北京   |  3 | 电脑         |
|  7 | 联想 14寸笔记本电脑                 |       3 |  2499 | 联想   | 北京   |  3 | 电脑         |
|  8 | 惠普黑白激光打印机                  |       4 |  1999 | 惠普   | 天津   |  4 | 办公用品     |
|  9 | 索尼 13寸触控超极本                 |       3 | 11499 | 索尼   | 深圳   |  3 | 电脑         |
+----+-------------------------------------+---------+-------+--------+--------+----+--------------+
9 rows in set (0.00 sec)

mysql>
```

#### 3、左外连接
```sql
形式：表1 left  [outer] join 表2 on 连接条件。
```
含义：其实就是讲两个表内连接的结果，在加上左表中不符合设定条件的那些数据的结果。（不符合条件的数据右表字段直接设置为null） 

举例：
```sql
mysql> select * from product t1 left outer join product_type t2 on t1.type_id = t2.id;
+----+-------------------------------------+---------+-------+--------+--------+------+--------------+
| id | pro_name                            | type_id | price | pinpai | chandi | id   | type_name    |
+----+-------------------------------------+---------+-------+--------+--------+------+--------------+
|  1 | 康佳42英寸全高清液晶电视            |       1 |  1999 | 康佳   | 深圳   |    1 | 家用电器     |
|  2 | 索宁60英寸全高清液晶电视            |       1 |  6999 | 索尼   | 北京   |    1 | 家用电器     |
|  3 | 海信55英寸智能电视                  |       1 |  4199 | 海信   | 青岛   |    1 | 家用电器     |
|  4 | 索宁 4个手机黑色                    |       2 |  3299 | 索尼   | 深圳   |    2 | 手机数码     |
|  5 | 联想双卡双待3g手机                  |       2 |   999 | 联想   | 北京   |    2 | 手机数码     |
|  6 | 联想 14寸笔记本电脑                 |       3 |  5499 | 联想   | 北京   |    3 | 电脑         |
|  7 | 联想 14寸笔记本电脑                 |       3 |  2499 | 联想   | 北京   |    3 | 电脑         |
|  8 | 惠普黑白激光打印机                  |       4 |  1999 | 惠普   | 天津   |    4 | 办公用品     |
|  9 | 索尼 13寸触控超极本                 |       3 | 11499 | 索尼   | 深圳   |    3 | 电脑         |
| 10 | 亲嘴烧                              |       9 |     2 | 天友   | 四川   | NULL | NULL         |
+----+-------------------------------------+---------+-------+--------+--------+------+--------------+
10 rows in set (0.00 sec)
```

#### 4、右外连接
形式：
```sql
表1 right  [outer] join 表2 on 连接条件。
```

含义：其实就是讲两个表内连接的结果，在加上右表中不符合设定条件的那些数据的结果。（不符合条件的数据左表字段直接设置为null）

举例：
```sql 
mysql> select * from product t1 right outer join product_type t2 on t1.type_id = t2.id;
+------+-------------------------------------+---------+-------+--------+--------+----+--------------+
| id   | pro_name                            | type_id | price | pinpai | chandi | id | type_name    |
+------+-------------------------------------+---------+-------+--------+--------+----+--------------+
|    1 | 康佳42英寸全高清液晶电视            |       1 |  1999 | 康佳   | 深圳   |  1 | 家用电器     |
|    2 | 索宁60英寸全高清液晶电视            |       1 |  6999 | 索尼   | 北京   |  1 | 家用电器     |
|    3 | 海信55英寸智能电视                  |       1 |  4199 | 海信   | 青岛   |  1 | 家用电器     |
|    4 | 索宁 4个手机黑色                    |       2 |  3299 | 索尼   | 深圳   |  2 | 手机数码     |
|    5 | 联想双卡双待3g手机                  |       2 |   999 | 联想   | 北京   |  2 | 手机数码     |
|    6 | 联想 14寸笔记本电脑                 |       3 |  5499 | 联想   | 北京   |  3 | 电脑         |
|    7 | 联想 14寸笔记本电脑                 |       3 |  2499 | 联想   | 北京   |  3 | 电脑         |
|    8 | 惠普黑白激光打印机                  |       4 |  1999 | 惠普   | 天津   |  4 | 办公用品     |
|    9 | 索尼 13寸触控超极本                 |       3 | 11499 | 索尼   | 深圳   |  3 | 电脑         |
| NULL | NULL                                |    NULL |  NULL | NULL   | NULL   |  6 | 厕所用品     |
| NULL | NULL                                |    NULL |  NULL | NULL   | NULL   |  5 | 厨房用品     |
+------+-------------------------------------+---------+-------+--------+--------+----+--------------+
11 rows in set (0.00 sec)
```

#### 5、全外连接
形式：没有形式，因为mysql不支持全连接的语法。

含义：其实就是讲两个表内连接的结果，在加上左右表中不符合设定条件的那些数据的结果。（不符合条件的数据对应左右表字段直接设置为null） 

## 8.6、子查询
> 所谓子查询就是在一个查询语句（select 语句）内部，某些位置又出现了‘查询语句’。因此就出现了主查询和子查询两个概念。通常子查询是为主查询服务的，子查询获得数据后再去执行主查询。

### 8.6.1、基本形式
一个主查询可以使用什么样的子查询，跟其所需要使用的位置和运算符有关，形式化后就是这样的：
```sql
select 字段或表达式或子查询 as [别名] from 表名或者连接结果或者子查询 where  字段或者表达式或者用子查询的条件判断
```

### 8.6.2、子查询的分类
1. 按子查询结果
    * 表子查询：返回结果为多行多列，此时可以当做“表”来使用，通常用在from后面。
    * 行子查询：返回结果为1行多列。
    * 列子查询：返回结果为多行一列标量子查询：返回结果为1行1列，此时可以作为一个值来使用，类似：select 8 as c1
2. 按子查询位置
    * 作为主查询的结果数据 
    ```sql
    select c1, (select f1 from tab2) as c2 from tab1 # 这里的子查询应该只有一个数据（一行一列，标量子查询）
    ```
    * 作为主查询的条件数据：
    ```sql
    select c1 from tab1 where c1 in (select f1 from tab2) # 这里查询的是多行数据（多行一列，列子查询）
    ```
    * 作为主查询的数据源
    ```sql
    select c1 from （select f1 as c1, f2 as c2 from tab2）as tab3 # 表子查询。
    ```

### 8.6.3、常见的子查询
1. 使用in的子查询

    形式：xx in （列子查询）

    举例：找出所有类别中带“电”字的所有商品。
    ```sql
    mysql> select * from product_type; # 带电字只有id为1 和 3的类别
    +----+--------------+
    | id | type_name    |
    +----+--------------+
    |  4 | 办公用品     |
    |  6 | 厕所用品     |
    |  5 | 厨房用品     |
    |  1 | 家用电器     |
    |  2 | 手机数码     |
    |  3 | 电脑         |
    +----+--------------+
    6 rows in set (0.00 sec)
    mysql> select pro_name from product where type_id in (select id from product_type where type_name like '%电%');
    +-------------------------------------+
    | pro_name                            |
    +-------------------------------------+
    | 康佳42英寸全高清液晶电视            |
    | 索宁60英寸全高清液晶电视            |
    | 海信55英寸智能电视                  |
    | 联想 14寸笔记本电脑                 |
    | 联想 14寸笔记本电脑                 |
    | 索尼 13寸触控超极本                 |
    +-------------------------------------+
    6 rows in set (0.00 sec)

    mysql>
    ```

2. 使用any的子查询

    形式：操作数 比较运算符 any (列子查询)

    含义：当某个操作数（字段）对于该子查询中的任意一个值，满足该比较运算符，则就是满足条件。即只要满足1，就输出。如下举例。
    ```sql
    mysql> select * from tab1;
    +------+------+
    | id   | name |
    +------+------+
    |    1 | aa   |
    |    2 | bb   |
    |    5 | cc   |
    |   10 | dd   |
    +------+------+
    4 rows in set (0.00 sec)

    mysql> select * from tab2;
    +------+------+
    | f1   | f2   |
    +------+------+
    |    3 | 33   |
    |    6 | 66   |
    |   12 | 1212 |
    +------+------+
    3 rows in set (0.00 sec)
    mysql> select * from tab1 where id > any (select f1 from tab2);
    +------+------+
    | id   | name |
    +------+------+
    |    5 | cc   |
    |   10 | dd   |
    +------+------+
    2 rows in set (0.00 sec)

    mysql>
    # 只有1、2不大于tab2 中f1列的任意一个值
    ```

3. 使用all的子查询

    形式：操作数 比较运算符 all (列子查询)

    含义：当某个操作数（字段）对于该子查询中的任意一个值，不满足该比较运算符，则就是不满足条件（与any相反）。即只要全部满足才会输出。如下举例
    ```sql
    mysql> select * from tab1;
    +------+------+
    | id   | name |
    +------+------+
    |    1 | aa   |
    |    2 | bb   |
    |    5 | cc   |
    |   10 | dd   |
    +------+------+
    4 rows in set (0.00 sec)

    mysql> select * from tab2;
    +------+------+
    | f1   | f2   |
    +------+------+
    |    3 | 33   |
    |    6 | 66   |
    |   12 | 1212 |
    +------+------+
    3 rows in set (0.00 sec)
    mysql> select * from tab2 where f1 > all (select id from tab1);
    +------+------+
    | f1   | f2   |
    +------+------+
    |   12 | 1212 |
    +------+------+
    1 row in set (0.00 sec)

    mysql>
    ```

4. 使用some的子查询

    > some是any的同义词。

5. 使用exists的子查询

    形式：where  exists (子查询)

    含义：该子查询如果有数据，则exists的结果为true，否则为false。

    说明：因为exists的含义，造成主查询往往会出现这样的情形：要么全部查询出来，要么都不查询出来。如果只局限于该含义，其基本就失去了它现实的使用意义。
    但，实际应用中，该子查询往往都不是独立的子查询，而是会需要跟主查询的数据源 （表），建立某种关系—通常就是连接关心。建立的方式是隐式的，即没有在代码上体现，但是却在内部有这种连接的实质。此隐式方式，通常体现在子查询中的where条件语句中，使用了主查询表中的数据字段。
      
    举例：
    ```sql
    mysql> select * from product where exists(select * from product_type where type_name like '%
    电%' and product_type.id = product.type_id);
    +----+-------------------------------------+---------+-------+--------+--------+
    | id | pro_name                            | type_id | price | pinpai | chandi |
    +----+-------------------------------------+---------+-------+--------+--------+
    |  1 | 康佳42英寸全高清液晶电视            |       1 |  1999 | 康佳   | 深圳   |
    |  2 | 索宁60英寸全高清液晶电视            |       1 |  6999 | 索尼   | 北京   |
    |  3 | 海信55英寸智能电视                  |       1 |  4199 | 海信   | 青岛   |
    |  6 | 联想 14寸笔记本电脑                 |       3 |  5499 | 联想   | 北京   |
    |  7 | 联想 14寸笔记本电脑                 |       3 |  2499 | 联想   | 北京   |
    |  9 | 索尼 13寸触控超极本                 |       3 | 11499 | 索尼   | 深圳   |
    +----+-------------------------------------+---------+-------+--------+--------+
    6 rows in set (0.00 sec)

    mysql>
    ```
    ::: danger 注意
    * 这种子查询语句，没法独立存在（独立运行），而是必须跟主查询一起使用。
    * 该子查询中的条件，应该设置为跟主查询某个字段有一定的关联性判断，通常该判断就是这两个表的“本来该有的连接条件”。
    :::

## 8.7、联合查询
### 8.7.1、基本概念
将两个具有相同字段数量的查询语句的结果，以上下堆积的方式合并成一个查询结果。如下
```sql
mysql> select * from tab1; # tab1 查询的结果
+------+------+
| id   | name |
+------+------+
|    1 | aa   |
|    2 | bb   |
|    5 | cc   |
|   10 | dd   |
+------+------+
4 rows in set (0.00 sec)

mysql> select * from tab2; # tab2查询的结果
+------+------+
| f1   | f2   |
+------+------+
|    3 | 33   |
|    6 | 66   |
|   12 | 1212 |
+------+------+
3 rows in set (0.00 sec)

mysql> select id, name from tab1 union select f1, f2 from tab2; # tab1和tab2联合查询的结果
+------+------+
| id   | name |
+------+------+
|    1 | aa   |
|    2 | bb   |
|    5 | cc   |
|   10 | dd   |
|    3 | 33   |
|    6 | 66   |
|   12 | 1212 |
+------+------+
7 rows in set (0.00 sec)

mysql>
```
::: tip 小结
小结：查询1与查询2查出的字段数量一致，并且最终结果以第一个查询的字段为结果字段
:::

### 8.7.2、联合查询语法形式
```sql
select 语句1 union [all | distinct]  select 语句2 ： 此联合查询语句，默认会自动消除重复行，即默认是distinct。

# 说明：
# 1. 两个select语句的查询结果的字段需要保持一致，个数必须相同，对应顺序上的字段类型也应该相同
# 2. All | distinct 表示两表的数据联合后是否需要消除相同行（数据）,All表示不消除（默认），distinct表示消除。
```

细节：
1. 应该将这个联合查询的结果理解为最终也是一个表格数据，且默认使用的第一个select语句中的字段。
2. 默认情况下，order by子句和limit子句只能对整个联合之后的结果进行排序和数量限定。

正确的做法：
```sql
mysql> select id, name from tab1 union select f1, f2 from tab2 order by id desc;
+------+------+
| id   | name |
+------+------+
|   12 | 1212 |
|   10 | dd   |
|    6 | 66   |
|    5 | cc   |
|    3 | 33   |
|    2 | bb   |
|    1 | aa   |
+------+------+
7 rows in set (0.03 sec)
```

错误的做法：
```sql
mysql> select id, name from tab1 order by id desc union select f1, f2 from tab2;
ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'union select f1, f2 from tab2' at line 1
mysql>
```
